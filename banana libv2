local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer

local Banana = {}
Banana.__index = Banana

local Theme = {
	BG = Color3.fromRGB(18,18,18),
	Side = Color3.fromRGB(28,28,28),
	Accent = Color3.fromRGB(255,221,0),
	Text = Color3.fromRGB(240,240,240)
}

-- draggable
local function MakeDraggable(frame)
	local dragging, dragStart, startPos

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(
				startPos.X.Scale,
				startPos.X.Offset + delta.X,
				startPos.Y.Scale,
				startPos.Y.Offset + delta.Y
			)
		end
	end)

	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = false
		end
	end)
end

function Banana:CreateWindow(title)

	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

	local Main = Instance.new("Frame", ScreenGui)
	Main.Size = UDim2.new(0,650,0,450)
	Main.Position = UDim2.new(0.5,-325,0.5,-225)
	Main.BackgroundColor3 = Theme.BG
	Main.BorderSizePixel = 0
	Main.Name = "BananaMain"

	local UICorner = Instance.new("UICorner", Main)
	UICorner.CornerRadius = UDim.new(0,12)

	local Stroke = Instance.new("UIStroke", Main)
	Stroke.Color = Theme.Accent
	Stroke.Thickness = 2

	MakeDraggable(Main)

	local Title = Instance.new("TextLabel", Main)
	Title.Size = UDim2.new(1,0,0,45)
	Title.BackgroundTransparency = 1
	Title.Text = title
	Title.Font = Enum.Font.GothamBold
	Title.TextSize = 22
	Title.TextColor3 = Theme.Accent

	local Side = Instance.new("Frame", Main)
	Side.Position = UDim2.new(0,0,0,45)
	Side.Size = UDim2.new(0,160,1,-45)
	Side.BackgroundColor3 = Theme.Side
	Instance.new("UICorner", Side).CornerRadius = UDim.new(0,12)

	local Content = Instance.new("Frame", Main)
	Content.Position = UDim2.new(0,160,0,45)
	Content.Size = UDim2.new(1,-160,1,-45)
	Content.BackgroundTransparency = 1

	local Window = {}
	Window.Tabs = {}
	Window.CurrentTab = nil

	-- multi tab fix
	function Window:CreateTab(name)

		local TabButton = Instance.new("TextButton", Side)
		TabButton.Size = UDim2.new(1,-10,0,40)
		TabButton.Position = UDim2.new(0,5,0,#Window.Tabs*45 + 5)
		TabButton.Text = name
		TabButton.BackgroundColor3 = Theme.Side
		TabButton.TextColor3 = Theme.Text
		TabButton.BorderSizePixel = 0
		Instance.new("UICorner", TabButton).CornerRadius = UDim.new(0,8)

		local TabFrame = Instance.new("ScrollingFrame", Content)
		TabFrame.Size = UDim2.new(1,0,1,0)
		TabFrame.CanvasSize = UDim2.new(0,0,0,0)
		TabFrame.ScrollBarThickness = 4
		TabFrame.Visible = false
		TabFrame.BackgroundTransparency = 1

		local Layout = Instance.new("UIListLayout", TabFrame)
		Layout.Padding = UDim.new(0,8)

		Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			TabFrame.CanvasSize = UDim2.new(0,0,0,Layout.AbsoluteContentSize.Y + 10)
		end)

		TabButton.MouseButton1Click:Connect(function()
			for _,tab in pairs(Window.Tabs) do
				tab.Frame.Visible = false
			end
			TabFrame.Visible = true
			Window.CurrentTab = TabFrame
		end)

		if not Window.CurrentTab then
			TabFrame.Visible = true
			Window.CurrentTab = TabFrame
		end

		local Tab = {}
		Tab.Frame = TabFrame

		function Tab:CreateButton(text, callback)
			local B = Instance.new("TextButton", TabFrame)
			B.Size = UDim2.new(1,-15,0,40)
			B.Text = text
			B.BackgroundColor3 = Theme.Accent
			B.TextColor3 = Color3.new(0,0,0)
			B.BorderSizePixel = 0
			Instance.new("UICorner", B).CornerRadius = UDim.new(0,8)

			B.MouseButton1Click:Connect(function()
				if callback then callback() end
			end)
		end

		function Tab:CreateToggle(text, default, callback)
			local state = default
			local B = Instance.new("TextButton", TabFrame)
			B.Size = UDim2.new(1,-15,0,40)
			B.Text = text.." : "..tostring(state)
			B.BackgroundColor3 = Theme.Side
			B.TextColor3 = Theme.Text
			B.BorderSizePixel = 0
			Instance.new("UICorner", B).CornerRadius = UDim.new(0,8)

			B.MouseButton1Click:Connect(function()
				state = not state
				B.Text = text.." : "..tostring(state)
				if callback then callback(state) end
			end)
		end

		Window.Tabs[name] = Tab
		return Tab
	end

	function Window:SetToggleKey(key)
		UserInputService.InputBegan:Connect(function(input)
			if input.KeyCode == key then
				Main.Visible = not Main.Visible
			end
		end)
	end

	return Window
end

return setmetatable({}, Banana)
