-- [[ üçå BANANA CUSTOM LIBRARY V6 - ULTIMATE ANIMATED EDITION ]] --
local BananaLib = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = game:GetService("Players").LocalPlayer
local Mouse = LocalPlayer:GetMouse()

function BananaLib:CreateWindow(Config)
    local HubName = Config.Name or "BANANA HUB"
    local ImageID = Config.BackgroundImage or ""
    local ToggleKey = Config.ToggleKey or Enum.KeyCode.RightControl
    
    local UI = Instance.new("ScreenGui")
    UI.Name = "BananaLib_V6"
    UI.Parent = game:GetService("CoreGui")
    UI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Parent = UI
    Main.Size = UDim2.new(0, 0, 0, 0) -- Startowa wielko≈õƒá do animacji
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
    Main.BorderSizePixel = 0
    Main.ClipsDescendants = true
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 15)

    -- Animacja otwierania (Pop-up)
    Main:TweenSizeAndPosition(UDim2.new(0, 580, 0, 400), UDim2.new(0.5, -290, 0.5, -200), "Out", "Back", 0.5, true)

    -- T≈ÅO (Image)
    if ImageID ~= "" then
        local BG = Instance.new("ImageLabel", Main)
        BG.Size = UDim2.new(1, 0, 1, 0)
        BG.Image = ImageID
        BG.ImageTransparency = Config.BackgroundTransparency or 0.7
        BG.ZIndex = 0
        Instance.new("UICorner", BG).CornerRadius = UDim.new(0, 15)
    end

    local Stroke = Instance.new("UIStroke", Main)
    Stroke.Thickness = 2
    Stroke.Color = Color3.fromRGB(255, 215, 0)
    Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    local Sidebar = Instance.new("Frame", Main)
    Sidebar.Size = UDim2.new(0, 160, 1, 0)
    Sidebar.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    Sidebar.BackgroundTransparency = 0.4
    Sidebar.ZIndex = 2
    Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0, 15)

    local TabContainer = Instance.new("ScrollingFrame", Sidebar)
    TabContainer.Size = UDim2.new(1, 0, 1, -80)
    TabContainer.Position = UDim2.new(0, 0, 0, 70)
    TabContainer.BackgroundTransparency = 1
    TabContainer.ScrollBarThickness = 0
    Instance.new("UIListLayout", TabContainer).Padding = UDim.new(0, 5)

    local ContentHolder = Instance.new("Frame", Main)
    ContentHolder.Size = UDim2.new(1, -170, 1, -20)
    ContentHolder.Position = UDim2.new(0, 165, 0, 10)
    ContentHolder.BackgroundTransparency = 1
    ContentHolder.ZIndex = 3

    -- Toggle UI klawiszem
    UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == ToggleKey then
            Main.Visible = not Main.Visible
        end
    end)

    -- PrzeciƒÖganie (Smooth)
    local dragging, dragInput, dragStart, startPos
    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = Main.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            TweenService:Create(Main, TweenInfo.new(0.15), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}):Play()
        end
    end)
    Main.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)

    local Tabs = {First = nil}

    function Tabs:CreateTab(Name, Icon)
        local ContentFrame = Instance.new("ScrollingFrame", ContentHolder)
        ContentFrame.Size = UDim2.new(1, 0, 1, 0)
        ContentFrame.Visible = false
        ContentFrame.BackgroundTransparency = 1
        ContentFrame.ScrollBarThickness = 2
        ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(255, 215, 0)
        Instance.new("UIListLayout", ContentFrame).Padding = UDim.new(0, 8)

        local TabBtn = Instance.new("TextButton", TabContainer)
        TabBtn.Size = UDim2.new(0.9, 0, 0, 35)
        TabBtn.Text = (Icon or "üîò") .. " " .. Name
        TabBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        TabBtn.BackgroundTransparency = 0.8
        TabBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
        TabBtn.Font = Enum.Font.GothamMedium
        Instance.new("UICorner", TabBtn)

        TabBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(ContentHolder:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible = false end end
            ContentFrame.Visible = true
            -- Animacja klikniƒôcia
            TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(255, 215, 0), BackgroundTransparency = 0.6}):Play()
            task.wait(0.3)
            TweenService:Create(TabBtn, TweenInfo.new(0.3), {BackgroundTransparency = 0.8, BackgroundColor3 = Color3.fromRGB(40, 40, 40)}):Play()
        end)

        if not Tabs.First then Tabs.First = true; ContentFrame.Visible = true end

        local Elements = {}

        -- BUTTON (Animated)
        function Elements:CreateButton(C)
            local B = Instance.new("TextButton", ContentFrame)
            B.Size = UDim2.new(0.95, 0, 0, 40)
            B.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            B.BackgroundTransparency = 0.4
            B.Text = "  " .. C.Name
            B.TextColor3 = Color3.fromRGB(255, 255, 255)
            B.Font = Enum.Font.Gotham
            B.TextXAlignment = Enum.TextXAlignment.Left
            Instance.new("UICorner", B)
            
            B.MouseEnter:Connect(function() TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 40, 40)}):Play() end)
            B.MouseLeave:Connect(function() TweenService:Create(B, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 25, 25)}):Play() end)
            B.MouseButton1Click:Connect(C.Callback)
        end

        -- SLIDER (Animated)
        function Elements:CreateSlider(C)
            local SFrame = Instance.new("Frame", ContentFrame)
            SFrame.Size = UDim2.new(0.95, 0, 0, 55)
            SFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            SFrame.BackgroundTransparency = 0.4
            Instance.new("UICorner", SFrame)

            local Title = Instance.new("TextLabel", SFrame)
            Title.Text = "  " .. C.Name; Title.Size = UDim2.new(1, 0, 0, 25); Title.BackgroundTransparency = 1; Title.TextColor3 = Color3.fromRGB(255, 255, 255); Title.TextXAlignment = Enum.TextXAlignment.Left

            local ValLabel = Instance.new("TextLabel", SFrame)
            ValLabel.Position = UDim2.new(1, -50, 0, 0); ValLabel.Size = UDim2.new(0, 40, 0, 25); ValLabel.BackgroundTransparency = 1; ValLabel.TextColor3 = Color3.fromRGB(255, 215, 0); ValLabel.Text = tostring(C.CurrentValue)

            local Bar = Instance.new("Frame", SFrame)
            Bar.Size = UDim2.new(0.9, 0, 0, 6); Bar.Position = UDim2.new(0.05, 0, 0.7, 0); Bar.BackgroundColor3 = Color3.fromRGB(45, 45, 45); Instance.new("UICorner", Bar)

            local Fill = Instance.new("Frame", Bar)
            Fill.Size = UDim2.new((C.CurrentValue - C.Min) / (C.Max - C.Min), 0, 1, 0); Fill.BackgroundColor3 = Color3.fromRGB(255, 215, 0); Instance.new("UICorner", Fill)

            local function Update()
                local perc = math.clamp((Mouse.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                local val = math.floor(C.Min + (C.Max - C.Min) * perc)
                TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(perc, 0, 1, 0)}):Play()
                ValLabel.Text = tostring(val)
                C.Callback(val)
            end

            Bar.InputBegan:Connect(function(i)
                if i.UserInputType == Enum.UserInputType.MouseButton1 then
                    local con; con = RunService.RenderStepped:Connect(Update)
                    UserInputService.InputEnded:Connect(function(i2) if i2.UserInputType == Enum.UserInputType.MouseButton1 then con:Disconnect() end end)
                end
            end)
        end

        -- DROPDOWN
        function Elements:CreateDropdown(C)
            local DFrame = Instance.new("Frame", ContentFrame)
            DFrame.Size = UDim2.new(0.95, 0, 0, 40)
            DFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
            DFrame.BackgroundTransparency = 0.4
            DFrame.ClipsDescendants = true
            Instance.new("UICorner", DFrame)

            local DBtn = Instance.new("TextButton", DFrame)
            DBtn.Size = UDim2.new(1, 0, 0, 40); DBtn.Text = "  " .. C.Name .. " (Select)"; DBtn.BackgroundTransparency = 1; DBtn.TextColor3 = Color3.fromRGB(255, 215, 0); DBtn.TextXAlignment = Enum.TextXAlignment.Left

            local open = false
            DBtn.MouseButton1Click:Connect(function()
                open = not open
                TweenService:Create(DFrame, TweenInfo.new(0.3), {Size = open and UDim2.new(0.95, 0, 0, #C.Options * 35 + 45) or UDim2.new(0.95, 0, 0, 40)}):Play()
            end)

            for _, opt in pairs(C.Options) do
                local O = Instance.new("TextButton", DFrame)
                O.Size = UDim2.new(1, 0, 0, 30); O.Position = UDim2.new(0, 0, 0, _ * 32 + 10); O.Text = opt; O.BackgroundTransparency = 1; O.TextColor3 = Color3.fromRGB(255, 255, 255)
                O.MouseButton1Click:Connect(function()
                    DBtn.Text = "  " .. C.Name .. ": " .. opt
                    open = false
                    TweenService:Create(DFrame, TweenInfo.new(0.3), {Size = UDim2.new(0.95, 0, 0, 40)}):Play()
                    C.Callback(opt)
                end)
            end
        end

        return Elements
    end
    return Tabs
end

return BananaLib
